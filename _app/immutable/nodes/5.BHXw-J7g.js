import"../chunks/DsnmJJEf.js";import"../chunks/BLfk3Fdv.js";import{o as Te}from"../chunks/C7YxkhMj.js";import{i as we,ad as Fe,J as L,ae as $,al as He,am as Se,a5 as d,ac as y,a6 as p,af as Re,ag as Be,a7 as n,a8 as r,g as e,b as l,e as w,a9 as s,y as Y,ab as ne}from"../chunks/CeaG_wZn.js";import{e as c,s as S}from"../chunks/jVuhULKV.js";import{i as D}from"../chunks/BdKxb9gU.js";import{e as j,i as Q}from"../chunks/WEfgH2ee.js";import{h as Ce}from"../chunks/DG9Tf6CV.js";import{s as x}from"../chunks/Cs2-i822.js";import{t as Me,g as i,s as Ne,V as ie,c as ce,a as Ve,b as We}from"../chunks/D1rAGPQ5.js";import{s as Ge,b as Le,a as Oe}from"../chunks/Cy_-4a0V.js";import{i as Ue}from"../chunks/D0D79LE3.js";function ve(A,Z,B,ee,O,t){var T=A.__className;if(we||T!==B||T===void 0){var F=Me(B,ee,t);(!we||F!==A.getAttribute("class"))&&(F==null?A.removeAttribute("class"):A.className=F),A.__className=B}else if(t&&O!==t)for(var C in t){var U=!!t[C];(O==null||U!==!!O[C])&&A.classList.toggle(C,U)}return t}var qe=d('<div class="player-icon svelte-1ly0pwl">P</div>'),ze=d("<img/>"),Je=d('<img class="tile-image svelte-1ly0pwl"/> <!> <!>',1),Ke=d("<div><!></div>"),Xe=d('<div class="map-row svelte-1ly0pwl"></div>'),Ye=d('<pre class="tooltip-content svelte-1ly0pwl"> </pre>'),je=d('<img class="encounter-image svelte-1ly0pwl"/> <h3> </h3> <div class="stats-and-hide-buttons svelte-1ly0pwl"><div class="stats-tooltip-container svelte-1ly0pwl"><button class="stats-button svelte-1ly0pwl" disabled>Stats</button> <!></div> <button class="hide-button svelte-1ly0pwl">Hide</button></div>',1),Qe=d('<p class="svelte-1ly0pwl"> </p>'),Ze=d("<p> </p> <p> </p>",1),et=d("<p> </p>"),tt=d('<div class="fullscreen-image-details svelte-1ly0pwl"><h3> </h3> <!> <!></div>'),at=d('<div class="fullscreen-overlay svelte-1ly0pwl"><div class="fullscreen-image-container svelte-1ly0pwl"><button class="close-button svelte-1ly0pwl">&times;</button> <img alt="Fullscreen" class="fullscreen-image svelte-1ly0pwl"/> <!></div></div>'),lt=d('<main tabindex="0" class="svelte-1ly0pwl"><div class="game-container svelte-1ly0pwl"><div class="map-screen svelte-1ly0pwl"></div> <div><!></div> <div class="text-box svelte-1ly0pwl"></div> <div class="buttons-tray svelte-1ly0pwl"><div class="dpad-container svelte-1ly0pwl"><div class="dpad-spacer svelte-1ly0pwl"></div> <button class="dpad-button up svelte-1ly0pwl">&#9650;</button> <div class="dpad-spacer svelte-1ly0pwl"></div> <button class="dpad-button left svelte-1ly0pwl">&#9664;</button> <button class="dpad-button down svelte-1ly0pwl">&#9660;</button> <button class="dpad-button right svelte-1ly0pwl">&#9654;</button></div> <div class="action-buttons svelte-1ly0pwl"><button class="action-button svelte-1ly0pwl">A</button> <button class="action-button svelte-1ly0pwl">B</button> <button class="action-button svelte-1ly0pwl">C</button> <button class="action-button svelte-1ly0pwl">D</button></div></div></div> <!></main>');function ft(A,Z){Fe(Z,!1);const[B,ee]=Oe();let t=L(Ge(i,"$gameStore",B)),T=L(),F=L(!0);i.subscribe(a=>{$(t,a)});function C(a,v){return e(t).map.find(o=>o.x===a&&o.y===v)}function U(a,v){return e(t).entities.filter(o=>o.x===a&&o.y===v)}function he(a){if(e(t).showFullscreenImage&&a.key==="Escape"){i.closeFullscreenImage();return}switch(a.key){case"ArrowUp":case"w":i.movePlayer(0,-1);break;case"ArrowDown":case"s":i.movePlayer(0,1);break;case"ArrowLeft":case"a":i.movePlayer(-1,0);break;case"ArrowRight":case"d":i.movePlayer(1,0);break}}let te=L(!1),q=L("");function ke(a){$(te,!0),a.type==="enemy"?$(q,`HP: ${a.hp}
Attack: ${a.attack}`):a.type==="npc"&&$(q,`Dialogue: ${a.dialogue[0]}`)}function Ee(){$(te,!1),$(q,"")}Te(()=>{e(T)&&e(T).focus()}),He(()=>e(t),()=>{e(t).currentEncounter&&$(F,!0)}),Se(),Ue();var M=lt();Ce(a=>{Be.title="Map - RPG"});var ae=n(M),z=n(ae);j(z,5,()=>(w(ie),l(()=>Array(ie))),Q,(a,v,o)=>{var m=Xe();j(m,5,()=>(w(ce),l(()=>Array(ce))),Q,(R,N,H,u)=>{const _=Y(()=>(e(t),l(()=>e(t).player.viewX+H))),f=Y(()=>(e(t),l(()=>e(t).player.viewY+o))),b=Y(()=>(w(e(_)),w(e(f)),l(()=>C(e(_),e(f))))),P=Y(()=>(w(e(_)),w(e(f)),l(()=>U(e(_),e(f)))));var h=Ke(),V=n(h);{var se=g=>{var E=Je(),I=ne(E),K=r(I,2);{var X=W=>{var k=qe();p(W,k)};D(K,W=>{e(t),w(e(_)),w(e(f)),l(()=>e(t).player.x===e(_)&&e(t).player.y===e(f))&&W(X)})}var oe=r(K,2);j(oe,1,()=>e(P),Q,(W,k)=>{var G=ze();y(()=>{x(G,"src",(e(k),l(()=>e(k).thumbnailImage))),x(G,"alt",(e(k),l(()=>e(k).name))),ve(G,1,`entity-icon ${e(k),l(()=>e(k).type)??""}`,"svelte-1ly0pwl"),x(G,"title",(e(k),l(()=>e(k).name)))}),p(W,G)}),y(()=>{x(I,"src",(w(e(b)),l(()=>e(b).tileImage))),x(I,"alt",(w(e(b)),l(()=>e(b).tileType)))}),p(g,E)};D(V,g=>{e(b)&&g(se)})}s(h),y(()=>ve(h,1,`map-tile ${w(e(b)),l(()=>e(b)?.tileType)??""}`,"svelte-1ly0pwl")),p(R,h)}),s(m),p(a,m)}),s(z);var J=r(z,2);let ue;var Ie=n(J);{var $e=a=>{var v=je(),o=ne(v),m=r(o,2),R=n(m,!0);s(m);var N=r(m,2),H=n(N),u=n(H),_=r(u,2);{var f=P=>{var h=Ye(),V=n(h,!0);s(h),y(()=>S(V,e(q))),p(P,h)};D(_,P=>{e(te)&&P(f)})}s(H);var b=r(H,2);s(N),y(()=>{x(o,"src",(e(t),l(()=>e(t).currentEncounter.image))),x(o,"alt",(e(t),l(()=>e(t).currentEncounter.name))),S(R,(e(t),l(()=>e(t).currentEncounter.name)))}),c("click",o,()=>i.openFullscreenImage(e(t).currentEncounter.image,{name:e(t).currentEncounter.name,type:e(t).currentEncounter.type,hp:e(t).currentEncounter.hp,attack:e(t).currentEncounter.attack,dialogue:e(t).currentEncounter.dialogue})),c("mouseenter",u,()=>ke(e(t).currentEncounter)),c("mouseleave",u,Ee),c("click",b,()=>$(F,!1)),p(a,v)};D(Ie,a=>{e(t),l(()=>e(t).currentEncounter)&&a($e)})}s(J);var le=r(J,2);j(le,5,()=>(e(t),l(()=>e(t).currentMessage)),Q,(a,v)=>{var o=Qe(),m=n(o,!0);s(o),y(()=>S(m,e(v))),p(a,o)}),s(le);var pe=r(le,2),re=n(pe),de=r(n(re),2),me=r(de,4),_e=r(me,2),Ae=r(_e,2);s(re);var fe=r(re,2),be=n(fe),ge=r(be,2),ye=r(ge,2),Pe=r(ye,2);s(fe),s(pe),s(ae);var De=r(ae,2);{var xe=a=>{var v=at(),o=n(v),m=n(o),R=r(m,2),N=r(R,2);{var H=u=>{var _=tt(),f=n(_),b=n(f,!0);s(f);var P=r(f,2);{var h=g=>{var E=Ze(),I=ne(E),K=n(I);s(I);var X=r(I,2),oe=n(X);s(X),y(()=>{S(K,`HP: ${e(t),l(()=>e(t).fullscreenImageDetails.hp)??""}`),S(oe,`Attack: ${e(t),l(()=>e(t).fullscreenImageDetails.attack)??""}`)}),p(g,E)};D(P,g=>{e(t),l(()=>e(t).fullscreenImageDetails.type==="enemy")&&g(h)})}var V=r(P,2);{var se=g=>{var E=et(),I=n(E);s(E),y(()=>S(I,`Dialogue: ${e(t),l(()=>e(t).fullscreenImageDetails.dialogue[0])??""}`)),p(g,E)};D(V,g=>{e(t),l(()=>e(t).fullscreenImageDetails.type==="npc")&&g(se)})}s(_),y(()=>S(b,(e(t),l(()=>e(t).fullscreenImageDetails.name)))),p(u,_)};D(N,u=>{e(t),l(()=>e(t).fullscreenImageDetails)&&u(H)})}s(o),s(v),y(()=>x(R,"src",(e(t),l(()=>e(t).fullscreenImageUrl)))),c("click",m,function(...u){i.closeFullscreenImage?.apply(this,u)}),c("click",o,Ve(function(u){We.call(this,Z,u)})),c("click",v,function(...u){i.closeFullscreenImage?.apply(this,u)}),p(a,v)};D(De,a=>{e(t),l(()=>e(t).showFullscreenImage)&&a(xe)})}s(M),Le(M,a=>$(T,a),()=>e(T)),y(a=>{Ne(z,`--viewport-width: ${ce}; --viewport-height: ${ie}; --tile-size: 32px;`),ue=ve(J,1,"encounter-box svelte-1ly0pwl",null,ue,a)},[()=>({hidden:!e(t).currentEncounter||!e(F)})]),c("click",de,()=>i.movePlayer(0,-1)),c("click",me,()=>i.movePlayer(-1,0)),c("click",_e,()=>i.movePlayer(0,1)),c("click",Ae,()=>i.movePlayer(1,0)),c("click",be,()=>i.handleAction("A")),c("click",ge,()=>i.handleAction("B")),c("click",ye,()=>i.handleAction("C")),c("click",Pe,()=>i.handleAction("D")),c("keydown",M,he),p(A,M),Re(),ee()}export{ft as component};
